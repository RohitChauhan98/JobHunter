// ─── Prisma Schema ─────────────────────────────────────────────────────────
// Database: NeonDB (serverless PostgreSQL)
//
// Models:
//   User          – Auth credentials
//   Profile       – Personal info (1:1 with User)
//   WorkExperience – Job history
//   Education     – Degrees
//   Skill         – Technical / soft / language skills
//   CustomAnswer  – Pre-written Q&A pairs
//   JobPreference – Target roles, locations, salary
//   Application   – Tracked job applications
//   AIConfig      – Per-user AI provider settings
// ────────────────────────────────────────────────────────────────────────────

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// ─── Auth ───────────────────────────────────────────────────────────────────

model User {
  id        String   @id @default(cuid())
  email     String   @unique
  password  String   // bcrypt hash
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  profile      Profile?
  applications Application[]
  aiConfig     AIConfig?
}

// ─── Profile ────────────────────────────────────────────────────────────────

model Profile {
  id        String @id @default(cuid())
  userId    String @unique
  user      User   @relation(fields: [userId], references: [id], onDelete: Cascade)

  firstName    String  @default("")
  lastName     String  @default("")
  email        String  @default("") // Contact email (may differ from auth email)
  phone        String  @default("")
  city         String  @default("")
  state        String  @default("")
  country      String  @default("")
  linkedinUrl  String  @default("")
  githubUrl    String  @default("")
  portfolioUrl String  @default("")
  website      String  @default("")
  summary      String  @default("") // Professional summary / bio

  resumeUrl      String @default("") // Link to hosted resume (Google Drive, Dropbox, etc.)
  resumeFileName String @default("") // Original filename of uploaded resume

  experience    WorkExperience[]
  education     Education[]
  skills        Skill[]
  customAnswers CustomAnswer[]
  preferences   JobPreference?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model WorkExperience {
  id          String   @id @default(cuid())
  profileId   String
  profile     Profile  @relation(fields: [profileId], references: [id], onDelete: Cascade)

  company      String
  title        String
  startDate    DateTime
  endDate      DateTime?
  isCurrent    Boolean  @default(false)
  description  String   @default("")
  achievements String[] // Array of bullet points
  technologies String[] // Tech stack used

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Education {
  id        String  @id @default(cuid())
  profileId String
  profile   Profile @relation(fields: [profileId], references: [id], onDelete: Cascade)

  institution String
  degree      String
  field       String
  startDate   DateTime
  endDate     DateTime?
  gpa         String  @default("")

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Skill {
  id        String  @id @default(cuid())
  profileId String
  profile   Profile @relation(fields: [profileId], references: [id], onDelete: Cascade)

  name        String
  category    SkillCategory
  proficiency Proficiency

  @@unique([profileId, name])
}

enum SkillCategory {
  technical
  soft
  language
}

enum Proficiency {
  beginner
  intermediate
  advanced
  expert
}

model CustomAnswer {
  id        String  @id @default(cuid())
  profileId String
  profile   Profile @relation(fields: [profileId], references: [id], onDelete: Cascade)

  question String
  answer   String

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model JobPreference {
  id        String  @id @default(cuid())
  profileId String  @unique
  profile   Profile @relation(fields: [profileId], references: [id], onDelete: Cascade)

  roles          String[]
  locations      String[]
  remoteOnly     Boolean @default(false)
  salaryMin      Int?
  salaryMax      Int?
  salaryCurrency String  @default("USD")
}

// ─── Application Tracking ───────────────────────────────────────────────────

model Application {
  id     String @id @default(cuid())
  userId String
  user   User   @relation(fields: [userId], references: [id], onDelete: Cascade)

  jobTitle  String
  company   String
  platform  String // greenhouse, lever, workday, etc.
  jobUrl    String
  status    ApplicationStatus @default(draft)
  appliedAt DateTime?
  notes     String @default("")

  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@index([userId, status])
}

enum ApplicationStatus {
  draft
  submitted
  rejected
  interview
  offer
  withdrawn
}

// ─── AI Configuration ───────────────────────────────────────────────────────

model AIConfig {
  id     String @id @default(cuid())
  userId String @unique
  user   User   @relation(fields: [userId], references: [id], onDelete: Cascade)

  activeProvider AIProvider @default(openai)

  openaiApiKey      String @default("")
  openaiModel       String @default("gpt-4o-mini")

  anthropicApiKey   String @default("")
  anthropicModel    String @default("claude-sonnet-4-20250514")

  openrouterApiKey  String @default("")
  openrouterModel   String @default("anthropic/claude-sonnet-4-20250514")

  localLlmUrl       String @default("http://localhost:11434")
  localLlmModel     String @default("llama3")

  // Generation settings
  temperature Float @default(0.7)
  maxTokens   Int   @default(1024)

  updatedAt DateTime @updatedAt
}

enum AIProvider {
  openai
  anthropic
  openrouter
  local
}
